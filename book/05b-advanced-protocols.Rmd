# Advanced Protocols

Advanced protocols can contain many more elements than the simple protocols
described in the previous chapter.  In this chapter we'll discuss `parameters`,
`objects`, `data` properties, variable scope, substitution, directives, and template functions.

## Parameters

Parameters are named values that you define at the beginning of a protocol.
You can then use the parameter name instead of the value later in the protocol.
In this partial example, a `VOLUME` parameter is defined which is used in the
`pipetter.pipette` step:

```yaml
parameters:
  VOLUME:
    description: "amount of water to dispense"
    value: 200 ul
...
steps:
  1:
    command: pipetter.pipette
    sources: water
    destinations: plate1(all)
    volumes: $#VOLUME
```

A parameter should be given a `description` and a `value`.
Notice that `$#` prefixes `VOLUME` in the step; `$#` tells Roboliq to substitute in a parameter value.  Substitution is discussed in more detail later in this chapter.

## Objects

There are several more object types you might want to use in advanced protocols:

[`Design`](../protocol/commands.html#_Design): for defining an experimental design.
The `Design` type facilitates complex experimental designs, and you can read
more about it in the chapter on [Design Tables].
  
[`Variable`](../protocol/commands.html#_Variable):
For defining references to other variables.
Variables are not particularly useful in Roboliq, but they could potentially
be used to easily switch between objects in case you have, for example,
two water sources `water1` and `water2`.  In that case you could have a `water`
variable whose value to set to the source you want to use:

```yaml
objects:
  water1: ...
  water2: ...
  water:
    description: "water source"
    type: Variable
    value: water1
steps:
  1:
    command: pipetter.pipette
    sources: water
    destinations: plate1(all)
    volumes: 50 ul
```  

[`Template`](../protocol/commands.html#_Template):
You can use a template to define re-usable steps.
Here is a toy example for a template named `dispenseToPlate1` which
creates a `pipetter.pipette` command that transfers a volume of water to
all wells on `plate1`:

```yaml
objects:
  plate1:
    type: Plate
    ...
  dispenseToPlate1:
    description: "template to dispense `volume` ul of water to all wells on plate1"
    type: Template
    template:
      command: pipetter.pipette
      sources: water
      destinations: plate1(all)
      volumes: "{{volume}}"
steps:
  1:
    command: system.call
    name: dispenseToPlate1
    params:
      volume: 10 ul
  2:
    command: system.call
    name: dispenseToPlate1
    params:
      volume: 50 ul
```

This protocol will first dispense 10ul to all wells, then another 50ul to all wells -- not actually a useful protocol, but it illustrates the point.
In the `system.call` command, the name of the template is specified along with the parameters template parameters.  Templates are expanded using the [Mustache](https://github.com/janl/mustache.js) template engine, which is the reason for the "{{" and "}}" delimiters in the line `volumes: "{{volume}}"`.

## Substitution

### `$` substitution

### String substitution

## Object references by name

## Functions
